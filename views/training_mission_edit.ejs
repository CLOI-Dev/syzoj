<% this.title = '编辑任务' %>
<% include header %>
<% 
  let levels = syzoj.config.training_levels;
%>
<div class="padding">
  <form class="ui form" action="<%= syzoj.utils.makeUrl(['training', 'mission', mission.id, 'edit']) %>" method="post">
      <div class="field">
          <label>任务名称</label>
          <input type="text" name="name" value="<%= mission.name %>">
      </div>
      <div class="field">
          <label>任务分类</label>
          <div class="ui fluid selection dropdown" id="mission_level">
            <input type="hidden" name="level" value="<%= mission.level %>">
            <i class="dropdown icon"></i>
            <div class="default text">选择分类</div>
            <div class="menu">  
              <% for (let nowLevel in levels) { 
                  for(let level of levels[nowLevel]) {%>
              <div class="item" data-value="<%= level %>">
                <%= level %>
              </div>
              <% }} %>
            </div>
          </div>
      </div>
      <div class="field">
        <label>分类排序序号（0开始）</label>
        <input type="text" name="idx" value="<%= mission.idx %>">
      </div>
      <div class="field">
          <label>试题列表</label>
          <select class="ui fluid search dropdown" multiple="" id="search_problems" name="problems">
          <% for (let problem of problems) { %>
          <option value="<%= problem.id %>" selected>#<%= problem.id %>. <%= problem.title %></option>
          <% } %>
          </select>
      </div>
      <div class="field">
        <label>背景图网址（请通过图床生成）</label>
        <input type="text" name="img_url" value="<%= mission.img_url %>">
      </div>
      <div class="field">
        <label>任务描述</label>
        <textarea name="description" rows="2"><%= mission.description %></textarea>
      </div>
      <div style="text-align: center; ">
      <button type="submit" class="ui labeled submit icon button">
        <i class="icon edit"></i> 提交  
      </button>
      </div>
  </form>
<script>
$(function () {
  $('#mission_level').dropdown();
  
  $('#search_problems')
    .dropdown({
      debug: true,
      apiSettings: {
        url: '/api/v2/search/problems/{query}',
        onResponse: function (response) {
          var a = $('#search_problems').val().map(function (x) { return parseInt(x) });
          if (response.results) {
            response.results = response.results.filter(function(x) {return !a.includes(parseInt(x.value));});
          }
          return response;
        },
        cache: false
      }
    });
});
</script>
<% include footer %>
